const fetch = require('node-fetch'); module.exports=async(req,res)=>{ if(req.method!=='POST') return res.status(405).send('Method Not Allowed'); const SENDGRID_API_KEY = process.env.SENDGRID_API_KEY; if(!SENDGRID_API_KEY) return res.status(500).json({error:'SendGrid key not configured'}); const body={personalizations:[{to:[{email:process.env.DELIVERY_TO_EMAIL||'you@example.com'}],subject:'SOUL CODE テストメール'}],from:{email:process.env.DELIVERY_FROM_EMAIL||'no-reply@soulcode.example'},content:[{type:'text/plain',value:'これは送信テストです。'}]}; const r=await fetch('https://api.sendgrid.com/v3/mail/send',{method:'POST',headers:{'Authorization':'Bearer '+SENDGRID_API_KEY,'Content-Type':'application/json'},body:JSON.stringify(body)}); if(r.status>=400) return res.status(500).json({error:'SendGrid error',status:r.status}); return res.json({ok:true}); };
