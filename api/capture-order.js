const fetch = require('node-fetch');
module.exports = async (req,res)=>{ if(req.method!=='POST')return res.status(405).send('Method Not Allowed'); const {orderID}=req.body||{}; const clientId=process.env.PAYPAL_CLIENT_ID, secret=process.env.PAYPAL_CLIENT_SECRET; if(!clientId||!secret) return res.status(500).json({error:'PayPal creds not set'}); try{ const t = await fetch('https://api-m.paypal.com/v1/oauth2/token',{method:'POST',headers:{'Authorization':'Basic '+Buffer.from(clientId+':'+secret).toString('base64'),'Content-Type':'application/x-www-form-urlencoded'},body:'grant_type=client_credentials'}); const tok=await t.json(); const access=tok.access_token; const cap = await fetch(`https://api-m.paypal.com/v2/checkout/orders/${orderID}/capture`,{method:'POST',headers:{'Authorization':'Bearer '+access,'Content-Type':'application/json'}}); const data=await cap.json(); return res.json(data);}catch(err){return res.status(500).json({error:String(err)})}};
