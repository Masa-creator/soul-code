const fetch = require('node-fetch');
module.exports = async (req,res)=>{ if(req.method!=='POST')return res.status(405).send('Method Not Allowed'); const {plan,amount} = req.body||{}; const clientId=process.env.PAYPAL_CLIENT_ID, secret=process.env.PAYPAL_CLIENT_SECRET; if(!clientId||!secret) return res.status(500).json({error:'PayPal creds not set'}); try{ const t = await fetch('https://api-m.paypal.com/v1/oauth2/token',{method:'POST',headers:{'Authorization':'Basic '+Buffer.from(clientId+':'+secret).toString('base64'),'Content-Type':'application/x-www-form-urlencoded'},body:'grant_type=client_credentials'}); const tok=await t.json(); const access=tok.access_token; const orderResp = await fetch('https://api-m.paypal.com/v2/checkout/orders',{method:'POST',headers:{'Authorization':'Bearer '+access,'Content-Type':'application/json'},body:JSON.stringify({intent:'CAPTURE',purchase_units:[{amount:{currency_code:'JPY',value: amount||'1480'}}]})}); const order=await orderResp.json(); return res.json(order);}catch(err){return res.status(500).json({error:String(err)})}};
